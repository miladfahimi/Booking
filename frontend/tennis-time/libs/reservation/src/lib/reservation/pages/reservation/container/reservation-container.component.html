<div class="limiter">
  <div class="container-calendar">
    <div class="wrap-calendar">
      <!-- Load Mobile or Desktop Calendar Component -->
      @let isMobileView = true;
      @if (isMobileView) {
      <app-reservation-calendar-mobile [isMobile]="isMobileView" (selectDay)="onDaySelected($event)">
      </app-reservation-calendar-mobile>
      } @else {
      <app-reservation-calendar-desktop [isMobile]="isMobileView" (selectDay)="onDaySelected($event)">
      </app-reservation-calendar-desktop>
      }

      @let basketItems = (basketItems$ | async) ?? [];
      @let basketTotal = (basketTotal$ | async) ?? 0;
      @let checkoutLoading = (checkoutLoading$ | async) ?? false;
      @let paymentResult = paymentResult$ | async;



      @if (isMobileView) {
      <app-timeline [services]="items" [slotsByService]="(timeSlots$ | async) ?? {}"
        (addToBasket)="onAddSlotToBasket($event)"></app-timeline>
      <button type="button" class="basket-fab" aria-label="سبد رزرو" [attr.aria-expanded]="basketModalOpen"
        (click)="openBasketModal()">
        <svg class="basket-fab__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M6 9h12l-1 11H7L6 9Z" fill="none" stroke="currentColor" stroke-width="1.5" />
          <path d="M9 9l3-4 3 4" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
        </svg>
        <span class="basket-fab__count" *ngIf="basketItems.length">{{ basketItems.length | faDigits }}</span>
      </button>

      @if (basketModalOpen) {
      <app-reservation-basket-modal [items]="basketItems" [total]="basketTotal" [loading]="checkoutLoading"
        [payment]="paymentResult" (remove)="onRemoveFromBasket($event)" (checkout)="onCheckout()"
        (close)="closeBasketModal()"></app-reservation-basket-modal>
      }
      } @else {
      <app-reservation-basket [items]="basketItems" [total]="basketTotal" [loading]="checkoutLoading"
        [payment]="paymentResult" (remove)="onRemoveFromBasket($event)"
        (checkout)="onCheckout()"></app-reservation-basket>
      }

      @if (isMobileView) {
      <app-reservation-footer-menu-mobile></app-reservation-footer-menu-mobile>
      }

    </div>
  </div>
</div>